原文：https://aurelia.io/docs/fundamentals/security#introduction

* [1.简介](#%E7%AE%80%E4%BB%8B)
* [2.Authentication and Authorization 认证与授权](#authentication-and-authorization-%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83)
* [3.Validation and Sanitization 验证与清理](#validation-and-sanitization-%E9%AA%8C%E8%AF%81%E4%B8%8E%E6%B8%85%E7%90%86)
* [4.Secret Data 机密数据](#secret-data-%E6%9C%BA%E5%AF%86%E6%95%B0%E6%8D%AE)
* [5.布署](#%E5%B8%83%E7%BD%B2)
* [6.Prepare for the Inevitable 为必然做准备](#prepare-for-the-inevitable-%E4%B8%BA%E5%BF%85%E7%84%B6%E5%81%9A%E5%87%86%E5%A4%87)
* [7.预防坏人](#%E9%A2%84%E9%98%B2%E5%9D%8F%E4%BA%BA)

## 简介

保护客户端应用程序的第一条规则:客户端不可信任。在任何情况下，后端都不应该信任来自前端的输入。恶意用户通常知道如何使用浏览器调试工具，并手动将HTTP请求发送到后端。您甚至可能发现自己处于这样一种情况:一名心怀不满的员工(或前员工)(他是一名熟悉系统的开发人员)试图通过恶意攻击进行报复。

**保护任何SPA应用程序(Aurelia或其他)的主要机制是努力保护后端服务。**


>**安全警告：**
>
>这篇文章或多或少只包含一些快速警告。它绝不是详尽的，也不应该是保护应用程序的唯一资源。安全方面的大部分工作与服务器端技术有关。您应该花足够的时间阅读和理解您所选择的任何后端技术的安全最佳实践。


## Authentication and Authorization 认证与授权

在设计应用程序时，请考虑哪些后端API调用可以匿名进行，哪些调用需要登录用户，哪些角色或权限需要用于各种经过身份验证的请求。确保以这种方式显式覆盖整个API表面积。你的前端可以方便的登录过程，但最终这是一个后端任务。以下是一些相关的建议:

*   确保您的服务器被配置为通过HTTPS传输敏感资源。您可能希望以这种方式传输所有资源。它是服务器密集型的，但是它更安全。您必须决定什么适合您的应用程序。
*   不要以纯文本方式传输密码。
*   有多种方法可以完成CORS。宁可使用基于服务器支持的CORS的技术，也不要使用客户端技巧。
*   控制对服务的跨域请求。要么不允许它们，要么根据严格的允许域**白名单**来配置服务器。
*   要求强密码
*   永远不要以纯文本形式存储密码。
*   不要允许对同一个帐户进行无数次失败的登录尝试。
*   考虑将您的验证需求外包给更专业的云提供商。

您可以通过使用安全细节插入Aurelia的路由器管道（router pipeline）来改进用户体验。同样，请记住，这并不能保护您的应用程序，但只能提供一个平稳的用户体验。真正的安全是在后台。下面是一个快速示例，演示如何使用Aurelia路由器根据用户角色禁用客户端路由:


**Customizing the Navigation Pipeline with Authorization 使用授权自定义导航管道**

```javascript
 import {Redirect} from 'aurelia-router';
  
  export class App {
    configureRouter(config) {
      config.title = 'Aurelia';
      config.addPipelineStep('authorize', AuthorizeStep);
      config.map([
        { route: ['welcome'], moduleId: 'welcome', title: 'Welcome', settings: { roles: [] } },
        { route: 'admin', moduleId: 'admin', title: 'Admin' settings: { roles: ['admin'] } }
      ]);
    }
  }
  
  class AuthorizeStep {
    run(navigationInstruction, next) {
      if (navigationInstruction.getAllInstructions().some(i => i.config.settings.roles.indexOf('admin') !== -1)) {
        var isAdmin = /* insert magic here */false;
        if (!isAdmin) {
          return next.cancel(new Redirect('welcome'));
        }
      }
  
      return next();
    }
  }
```


>提醒：** Route Settings**
>
>开发人员可以将`settings`属性添加到任何路由配置对象中，并使用它来存储希望与路由关联的任何数据。`settings`属性的值将由Aurelia的路由器保存并复制到导航模型中。



## Validation and Sanitization 验证与清理

后端应该始终执行数据的验证和清理。不要依赖客户端验证和清理代码。实际上，您的客户端验证/验证代码应该被看作是用户体验的增强，旨在帮助诚实的用户。它不会影响任何有恶意的人。

这里有一些你应该做的事情:

*   使用客户端验证。这将使您的用户满意。
*   避免将数据绑定到`innerHTML`。如果这样做，请确保使用值转换器来清除来自用户的输入。
*   在基于用户输入动态创建和编译客户端模板时要格外小心。
*   在基于用户输入在服务器上动态创建模板时要格外小心，稍后Aurelia将在客户机上处理这些模板。



>提示：** We Are Trying To Help You**
>
>在内部，Aurelia没有使用`eval`或`Function` 构造函数。此外，所有的绑定表达式都是由我们的严格解析器解析的，它不会在绑定表达式中提供`window`或`document`等全局变量。我们这样做是为了防止一些常见的滥用。



## Secret Data 机密数据

不要在JavaScript代码中嵌入私钥。虽然普通用户可能无法访问它们，但是任何怀有恶意的人都可以下载您的客户端代码，然后使用基本的正则表达式在代码库中查找类似敏感数据的内容。也许他们只是通过研究应用程序的HTTP请求或查看页面源代码就发现了您正在使用的后端技术或您的产品基于什么云服务。通过使用这些信息，他们可以根据这些技术的用户熟悉的某些模式改进搜索，从而更容易地找到您的私钥。

如果您需要获取客户机上的任何秘密数据，那么应该非常小心地进行。以下是(非详尽的)建议列表：

*   始终使用HTTPS传输此信息。
*   将哪些用户和角色可以获取此信息限制到最小。
*   对任何密钥都要使用超时，这样，如果攻击者获得了访问权限，他们就不能长时间地使用它们。
*   请注意如何在内存中存储这些值。不要将它们存储为类属性值，也不要存储在通过数据绑定或其他方式链接到DOM的任何对象上。这样做将允许攻击者通过调试控制台访问信息。如果必须存储此信息，请将其保存在私有(非导出)模块级变量中。
*   如果您需要将此信息存储在任何地方，请首先对其进行加密。



## 布署

在部署您的应用程序时，您可以做一些事情来让攻击者更难理解您的客户端是如何工作的:

*   将应用程序打包并缩小其规模。这是最基本的混淆。
*   不要部署原始客户端源文件。只部署你的捆绑包，缩小的应用程序。
*   为了获得额外的安全性或IP保护，您可能需要查看[jscrambler](https://jscrambler.com/en/)之类的产品。



## Prepare for the Inevitable 为必然做准备

即使有最熟练、安全精通的开发团队，您的应用程序也不会受到100%的保护。这是你们一开始就应该有的基本假设。期待被攻击，期待有人在某一时刻成功。如果发生这种情况，你会怎么做?你将如何回应?你能找到罪犯吗?你能找出问题所在并迅速堵住漏洞吗?你需要一个计划。

同样，这主要取决于服务器端实现。以下是一些基本的想法:

*   配置服务器端日志记录，并确保它将为您提供有用的信息。这些信息对于跟踪攻击是如何执行的非常有用。确保您有可用的工具来快速搜索日志。
*   确保所有登录都已被记录。如果您使用的是authtoken方案，请确保所有请求都记录此信息。
*   从不记录敏感数据。
*   考虑注销登录或验证令牌。您可以提供刷新机制来帮助用户体验。
*   配置server insight工具，以便能够更早地检测到威胁。



## 预防坏人

小心你所提供的信息，特别是当事情出错的时候。例如，如果登录尝试失败，不要告诉用户他们的用户名或密码是否错误。信息太多了。只要告诉他们登录错误就行了。此外，要注意发送给最终用户的错误信息。您应该保留详细的内部错误日志，但是大多数信息不应该发送给最终用户。太多的信息可以帮助攻击者离造成真正的伤害更近一步。

除此之外，当您知道用户在做一些恶意的事情时，您没有义务提供任何类型的友好消息。让应用程序崩溃吧。这很适合他们。
